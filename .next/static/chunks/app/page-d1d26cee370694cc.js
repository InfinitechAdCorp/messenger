(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7970:function(e,r,t){Promise.resolve().then(t.bind(t,6598))},6598:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Home}});var a=t(7437),s=t(2265),l=t(7256),n=t(6061),i=t(7042),d=t(4769);function cn(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,d.m6)((0,i.W)(r))}let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,r)=>{let{className:t,variant:s,size:n,asChild:i=!1,...d}=e,c=i?l.g7:"button";return(0,a.jsx)(c,{className:cn(o({variant:s,size:n,className:t})),ref:r,...d})});c.displayName="Button";let x=s.forwardRef((e,r)=>{let{className:t,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...l})});x.displayName="Input";let m=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});m.displayName="Card";let h=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:cn("flex flex-col space-y-1.5 p-6",t),...s})});h.displayName="CardHeader";let g=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:cn("text-2xl font-semibold leading-none tracking-tight",t),...s})});g.displayName="CardTitle";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:cn("text-sm text-muted-foreground",t),...s})});u.displayName="CardDescription";let f=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:cn("p-6 pt-0",t),...s})});f.displayName="CardContent";let b=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:cn("flex items-center p-6 pt-0",t),...s})});b.displayName="CardFooter";var p=t(4169);let y=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(p.fC,{ref:r,className:cn("",t),...s})});y.displayName=p.fC.displayName;let v=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(p.aV,{ref:r,className:cn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s})});v.displayName=p.aV.displayName;let j=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(p.xz,{ref:r,className:cn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s})});j.displayName=p.xz.displayName;let N=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(p.VY,{ref:r,className:cn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s})});N.displayName=p.VY.displayName;var w=t(6743);let k=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),C=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(w.f,{ref:r,className:cn(k(),t),...s})});C.displayName=w.f.displayName;let S=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Z=s.forwardRef((e,r)=>{let{className:t,variant:s,...l}=e;return(0,a.jsx)("div",{ref:r,className:cn(S({variant:s}),t),role:"alert",...l})});Z.displayName="Alert";let T=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h5",{ref:r,className:cn("mb-1 font-medium leading-none tracking-tight",t),...s})});T.displayName="AlertTitle";let M=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:cn("text-sm [&_p]:leading-relaxed",t),...s})});function LoginForm(e){let{onLogin:r}=e,[t,l]=(0,s.useState)({username:"",password:""}),[n,i]=(0,s.useState)({username:"",email:"",password:"",fullName:""}),[d,o]=(0,s.useState)(!1),[u,b]=(0,s.useState)(""),handleLogin=async e=>{e.preventDefault(),o(!0),b("");try{let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await e.json();if(!e.ok)throw Error(a.message||"Login failed");r(a.user)}catch(e){b(e instanceof Error?e.message:"Login failed")}finally{o(!1)}},handleRegister=async e=>{e.preventDefault(),o(!0),b("");try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n.username,email:n.email,password:n.password,full_name:n.fullName})}),t=await e.json();if(!e.ok)throw Error(t.message||"Registration failed");r(t.user)}catch(e){b(e instanceof Error?e.message:"Registration failed")}finally{o(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsxs)(m,{className:"w-full max-w-md",children:[(0,a.jsx)(h,{children:(0,a.jsx)(g,{className:"text-center text-2xl font-bold",children:"Messenger"})}),(0,a.jsxs)(f,{children:[u&&(0,a.jsx)(Z,{className:"mb-4",children:(0,a.jsx)(M,{children:u})}),(0,a.jsxs)(y,{defaultValue:"login",className:"w-full",children:[(0,a.jsxs)(v,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(j,{value:"login",children:"Login"}),(0,a.jsx)(j,{value:"register",children:"Register"})]}),(0,a.jsx)(N,{value:"login",children:(0,a.jsxs)("form",{onSubmit:handleLogin,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"username",children:"Username"}),(0,a.jsx)(x,{id:"username",type:"text",placeholder:"Enter username",value:t.username,onChange:e=>l({...t,username:e.target.value}),required:!0,disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"password",children:"Password"}),(0,a.jsx)(x,{id:"password",type:"password",placeholder:"Enter password",value:t.password,onChange:e=>l({...t,password:e.target.value}),required:!0,disabled:d})]}),(0,a.jsx)(c,{type:"submit",className:"w-full",disabled:d,children:d?"Logging in...":"Login"})]})}),(0,a.jsx)(N,{value:"register",children:(0,a.jsxs)("form",{onSubmit:handleRegister,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"fullName",children:"Full Name"}),(0,a.jsx)(x,{id:"fullName",type:"text",placeholder:"Enter full name",value:n.fullName,onChange:e=>i({...n,fullName:e.target.value}),required:!0,disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"email",children:"Email"}),(0,a.jsx)(x,{id:"email",type:"email",placeholder:"Enter email",value:n.email,onChange:e=>i({...n,email:e.target.value}),required:!0,disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"regUsername",children:"Username"}),(0,a.jsx)(x,{id:"regUsername",type:"text",placeholder:"Choose username",value:n.username,onChange:e=>i({...n,username:e.target.value}),required:!0,disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"regPassword",children:"Password"}),(0,a.jsx)(x,{id:"regPassword",type:"password",placeholder:"Choose password",value:n.password,onChange:e=>i({...n,password:e.target.value}),required:!0,disabled:d})]}),(0,a.jsx)(c,{type:"submit",className:"w-full",disabled:d,children:d?"Registering...":"Register"})]})})]})]})]})})}M.displayName="AlertDescription";var L=t(2176),F=t(5750),E=t(9183),A=t(2549),R=t(4135),z=t(3088),I=t(9409),q=t(5883);function Sidebar(e){let{currentUser:r,activeView:t,onViewChange:l,onLogout:n,isMobile:i=!1,onClose:d}=e,[o,x]=(0,s.useState)(!1),m=[{id:"chats",label:"Chats",icon:L.Z},{id:"friends",label:"Friends",icon:F.Z},{id:"groups",label:"Groups",icon:E.Z}],toggleTheme=()=>{x(!o),document.documentElement.classList.toggle("dark")};return i?(0,a.jsxs)("div",{className:"w-64 bg-white dark:bg-gray-800 h-full flex flex-col shadow-xl",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:r.fullName.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:r.fullName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",r.username]})]})]}),d&&(0,a.jsx)("button",{onClick:d,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("nav",{className:"flex-1 p-4 space-y-2",children:m.map(e=>{let r=e.icon;return(0,a.jsxs)(c,{variant:"ghost",className:"w-full justify-start h-12 px-4 ".concat(t===e.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),onClick:()=>l(e.id),children:[(0,a.jsx)(r,{className:"w-5 h-5 mr-3"}),e.label]},e.id)})}),(0,a.jsxs)("div",{className:"p-4 space-y-2 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)(c,{variant:"ghost",className:"w-full justify-start h-12 px-4 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:toggleTheme,children:[o?(0,a.jsx)(R.Z,{className:"w-5 h-5 mr-3"}):(0,a.jsx)(z.Z,{className:"w-5 h-5 mr-3"}),o?"Light Mode":"Dark Mode"]}),(0,a.jsxs)(c,{variant:"ghost",className:"w-full justify-start h-12 px-4 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,a.jsx)(I.Z,{className:"w-5 h-5 mr-3"}),"Settings"]}),(0,a.jsxs)(c,{variant:"ghost",className:"w-full justify-start h-12 px-4 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:n,children:[(0,a.jsx)(q.Z,{className:"w-5 h-5 mr-3"}),"Logout"]})]})]}):(0,a.jsxs)("div",{className:"w-16 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col",children:[(0,a.jsx)("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:r.fullName.charAt(0).toUpperCase()})}),(0,a.jsx)("nav",{className:"flex-1 flex flex-col space-y-1 p-2",children:m.map(e=>{let r=e.icon;return(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"w-12 h-12 p-0 rounded-xl transition-all duration-200 ".concat(t===e.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),onClick:()=>l(e.id),title:e.label,children:(0,a.jsx)(r,{className:"w-5 h-5"})},e.id)})}),(0,a.jsxs)("div",{className:"p-2 space-y-1 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"w-12 h-12 p-0 rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:toggleTheme,title:"Toggle Theme",children:o?(0,a.jsx)(R.Z,{className:"w-5 h-5"}):(0,a.jsx)(z.Z,{className:"w-5 h-5"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"w-12 h-12 p-0 rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Settings",children:(0,a.jsx)(I.Z,{className:"w-5 h-5"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"w-12 h-12 p-0 rounded-xl text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:n,title:"Logout",children:(0,a.jsx)(q.Z,{className:"w-5 h-5"})})]})]})}let O=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:r,variant:t,...s}=e;return(0,a.jsx)("div",{className:cn(O({variant:t}),r),...s})}var U=t(3008),D=t(261),B=t(8784),W=t(9168),P=t(2369),G=t(7405),V=t(1827),_=t(3021);function DesktopSidebarV2(e){let{currentUser:r,activeView:t,onViewChange:l,onLogout:n,unreadCount:i=0,onlineCount:d=0,isConnected:o=!0,connectionStatus:x="disabled"}=e,[m,h]=(0,s.useState)(!0),g=(null==r?void 0:r.fullName)||(null==r?void 0:r.username)||"User",u=(null==r?void 0:r.username)||"user",f=(null==r?void 0:r.id)||0,b=g.charAt(0).toUpperCase(),p=[{id:"chats",label:"Chats",icon:L.Z,badge:i>0?i:null,description:"Your conversations",neonColor:"cyan",glowColor:"shadow-cyan-500/50"},{id:"friends",label:"Friends",icon:F.Z,badge:d>0?d:null,description:"Manage connections",neonColor:"green",glowColor:"shadow-green-500/50"},{id:"groups",label:"Groups",icon:E.Z,badge:null,description:"Team conversations",neonColor:"purple",glowColor:"shadow-purple-500/50"}],y=(()=>{switch(x){case"connected":default:return{text:"ONLINE",color:"text-green-400",bgColor:"bg-green-400",icon:U.Z};case"connecting":return{text:"CONNECTING",color:"text-yellow-400",bgColor:"bg-yellow-400",icon:D.Z};case"disconnected":return{text:"OFFLINE",color:"text-red-400",bgColor:"bg-red-400",icon:B.Z}}})(),v=y.icon;return(0,a.jsxs)("div",{className:"w-80 bg-gray-900 border-r border-gray-800 flex flex-col shadow-2xl relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,a.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"\n            linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),\n            linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px)\n          ",backgroundSize:"20px 20px"}})}),(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 animate-pulse"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 animate-pulse"}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-800 relative z-10",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-cyan-400 to-purple-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-cyan-500/25 group-hover:shadow-cyan-500/50 transition-all duration-300 group-hover:scale-105 border border-cyan-500/30",children:b}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 ".concat(y.bgColor," border-2 border-gray-900 rounded-full shadow-lg ").concat(y.bgColor.replace("bg-","shadow-"),"/50 ").concat("connecting"===x?"animate-pulse":""," flex items-center justify-center"),children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,a.jsx)(W.Z,{className:"absolute -top-2 -right-2 w-5 h-5 text-yellow-400 animate-bounce"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("h3",{className:"font-black text-white truncate text-xl flex items-center",children:[g,(0,a.jsx)(P.Z,{className:"w-4 h-4 ml-2 text-yellow-400 animate-pulse"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 truncate flex items-center",children:[(0,a.jsx)(G.Z,{className:"w-3 h-3 mr-1 text-cyan-400"}),"@",u]})]})]})}),(0,a.jsx)("div",{className:"px-6 py-3 bg-gray-800/50 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsxs)("span",{className:"font-bold flex items-center ".concat(y.color),children:[(0,a.jsx)("div",{className:"w-2 h-2 ".concat(y.bgColor," rounded-full mr-2 ").concat("connecting"===x?"animate-pulse":"")}),y.text]}),(0,a.jsxs)("span",{className:"text-cyan-400 font-mono",children:["#",f.toString().padStart(4,"0")]})]})}),(0,a.jsx)("div",{className:"p-4 border-b border-gray-800 relative z-10",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)(c,{variant:"ghost",size:"sm",className:"h-12 justify-start bg-gray-800/50 hover:bg-gray-700/50 border border-cyan-500/30 rounded-xl transition-all duration-300 hover:shadow-lg hover:shadow-cyan-500/25 hover:border-cyan-500/50 group",children:[(0,a.jsx)(V.Z,{className:"w-4 h-4 mr-2 text-cyan-400 group-hover:animate-pulse"}),(0,a.jsx)("span",{className:"font-bold text-gray-300 group-hover:text-white",children:"SEARCH"})]}),(0,a.jsxs)(c,{onClick:()=>{},variant:"ghost",size:"sm",className:"h-12 justify-start bg-gray-800/50 hover:bg-gray-700/50 border border-purple-500/30 rounded-xl transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/25 hover:border-purple-500/50 group relative",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2 text-purple-400 group-hover:animate-pulse"}),(0,a.jsx)("span",{className:"font-bold text-gray-300 group-hover:text-white",children:"ALERTS"}),i>0&&(0,a.jsx)(Badge,{className:"absolute -top-1 -right-1 bg-red-500 text-white border-0 shadow-lg shadow-red-500/50 animate-pulse font-black text-xs min-w-[20px] h-5",children:i>99?"99+":i})]})]})}),"disabled"!==x&&(0,a.jsx)("div",{className:"px-6 py-2 border-b border-gray-800",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-xs",children:[(0,a.jsx)(v,{className:"w-4 h-4 ".concat(y.color," ").concat("connecting"===x?"animate-pulse":"")}),(0,a.jsxs)("span",{className:"".concat(y.color," font-bold"),children:["connected"===x&&"REAL-TIME ENABLED","connecting"===x&&"CONNECTING...","disconnected"===x&&"RECONNECTING..."]})]})}),(0,a.jsxs)("nav",{className:"flex-1 p-4 space-y-4 relative z-10",children:[(0,a.jsxs)("div",{className:"text-xs font-black text-gray-500 uppercase tracking-widest mb-6 flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-cyan-400 rounded-full mr-3 animate-pulse"}),"NAVIGATION"]}),p.map(e=>{let r=e.icon,s=t===e.id;return(0,a.jsxs)(c,{variant:"ghost",className:"w-full justify-start h-18 px-4 rounded-2xl transition-all duration-300 group relative overflow-hidden ".concat(s?"bg-gray-800 border-2 border-".concat(e.neonColor,"-500 shadow-xl ").concat(e.glowColor," shadow-lg"):"hover:bg-gray-800/50 hover:border hover:border-gray-600"),onClick:()=>l(e.id),children:[s&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-".concat(e.neonColor,"-500/10 to-transparent animate-pulse")}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 w-full relative z-10",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl transition-all duration-300 group-hover:scale-110 ".concat(s?"bg-".concat(e.neonColor,"-500 text-white shadow-lg ").concat(e.glowColor):"bg-gray-700 border border-gray-600 text-gray-300 group-hover:border-gray-500"),children:(0,a.jsx)(r,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-black text-lg ".concat(s?"text-white":"text-gray-300 group-hover:text-white"),children:e.label.toUpperCase()}),e.badge&&(0,a.jsx)(Badge,{className:"bg-".concat(e.neonColor,"-500 text-white border-0 shadow-lg ").concat(e.glowColor," animate-pulse font-black"),children:e.badge>99?"99+":e.badge})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1 font-mono uppercase tracking-wide",children:e.description})]})]})]},e.id)})]}),(0,a.jsxs)("div",{className:"p-4 space-y-3 border-t border-gray-800 relative z-10",children:[(0,a.jsx)(c,{variant:"ghost",className:"w-full justify-start h-16 px-4 rounded-2xl bg-gray-800/50 hover:bg-gray-700/50 border border-yellow-500/30 transition-all duration-300 hover:shadow-lg hover:shadow-yellow-500/25 hover:border-yellow-500/50 group",onClick:()=>{h(!m),document.documentElement.classList.toggle("dark")},children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl bg-yellow-500 text-black group-hover:scale-110 transition-transform duration-300 shadow-lg shadow-yellow-500/50",children:m?(0,a.jsx)(R.Z,{className:"w-5 h-5"}):(0,a.jsx)(z.Z,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"font-black text-gray-300 group-hover:text-white text-lg",children:m?"LIGHT MODE":"DARK MODE"})]})}),(0,a.jsx)(c,{variant:"ghost",className:"w-full justify-start h-16 px-4 rounded-2xl bg-gray-800/50 hover:bg-gray-700/50 border border-blue-500/30 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/25 hover:border-blue-500/50 group",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl bg-blue-500 text-white group-hover:scale-110 transition-transform duration-300 shadow-lg shadow-blue-500/50",children:(0,a.jsx)(I.Z,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"font-black text-gray-300 group-hover:text-white text-lg",children:"SETTINGS"})]})}),(0,a.jsx)(c,{variant:"ghost",className:"w-full justify-start h-16 px-4 rounded-2xl bg-red-900/20 hover:bg-red-800/30 border border-red-500/30 transition-all duration-300 hover:shadow-lg hover:shadow-red-500/25 hover:border-red-500/50 group",onClick:n,children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl bg-red-500 text-white group-hover:scale-110 transition-transform duration-300 shadow-lg shadow-red-500/50",children:(0,a.jsx)(q.Z,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"font-black text-red-400 group-hover:text-red-300 text-lg",children:"SIGN OUT"})]})})]})]})}var Y=t(4990),H=t(3067),J=t(290),K=t(2741),Q=t(8339),X=t(1942),$=t(6489),ee=t(6020),er=t(7972);function GroupMembersModal(e){var r;let{group:t,onClose:l,currentUserId:n}=e,[i,d]=(0,s.useState)([]),[o,x]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let loadMembers=async()=>{try{let e=await fetch("/api/friends");if(e.ok){let r=await e.json(),a=r.filter(e=>t.members.includes(e.id)).map(e=>({...e,role:e.id===t.createdBy?"admin":"member",joinedAt:new Date().toISOString()}));t.members.includes(n)&&a.push({id:n,username:"You",fullName:"You",status:"online",role:n===t.createdBy?"admin":"member",joinedAt:new Date().toISOString()}),d(a)}}catch(e){console.error("Failed to load group members:",e)}finally{x(!1)}};loadMembers()},[t,n]);let m=i.filter(e=>"admin"===e.role),h=i.filter(e=>"member"===e.role);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&l()},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:t.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.length," ",1===i.length?"member":"members"]})]}),(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96",children:o?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[m.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)(W.Z,{className:"w-4 h-4 text-yellow-500"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide",children:"Admins"})]}),(0,a.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-white font-semibold",children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.id===n?"You":e.fullName}),(0,a.jsx)(Badge,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-0 text-xs",children:"Admin"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username," • ",e.status]})]}),e.id!==n&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(L.Z,{className:"w-4 h-4"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(K.Z,{className:"w-4 h-4"})})]})]},e.id))})]}),h.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)(er.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide",children:"Members"})]}),(0,a.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold",children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.id===n?"You":e.fullName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username," • ",e.status]})]}),e.id!==n&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(L.Z,{className:"w-4 h-4"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(K.Z,{className:"w-4 h-4"})})]})]},e.id))})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,a.jsxs)("span",{children:["Created by ",(null===(r=m.find(e=>e.id===t.createdBy))||void 0===r?void 0:r.fullName)||"Unknown"]}),(0,a.jsxs)("span",{children:[i.length," total members"]})]})})]})})}var et=t(2527),ea=t(3480),es=t(2894);function UnfriendConfirmationModal(e){let{friend:r,onClose:t,onConfirm:l}=e,[n,i]=(0,s.useState)(!1),handleConfirm=async()=>{try{i(!0),await l(r.id),t()}catch(e){console.error("Failed to unfriend:",e)}finally{i(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(es.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Remove Friend"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This action cannot be undone"})]})]}),(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:t,className:"p-2 hover:bg-white/50 dark:hover:bg-gray-700 rounded-full",disabled:n,children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold shadow-lg",children:r.fullName.charAt(0).toUpperCase()}),"online"===r.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white truncate",children:r.fullName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",r.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("online"===r.status?"bg-green-400":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:r.status})]})]})]}),(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(es.Z,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:["Are you sure you want to remove ",r.fullName,"?"]}),(0,a.jsxs)("ul",{className:"text-sm text-yellow-700 dark:text-yellow-300 space-y-1",children:[(0,a.jsx)("li",{children:"• You will no longer be friends"}),(0,a.jsx)("li",{children:"• Your chat history will be deleted"}),(0,a.jsx)("li",{children:"• You'll need to send a new friend request to reconnect"}),(0,a.jsx)("li",{children:"• They won't be notified about this action"})]})]})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(c,{onClick:t,variant:"outline",className:"flex-1 px-4 py-3 border-gray-300 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 rounded-xl font-medium transition-all duration-300",disabled:n,children:"Cancel"}),(0,a.jsx)(c,{onClick:handleConfirm,disabled:n,className:"flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl font-medium transition-all duration-300 hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:n?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Removing..."})]}):(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Remove Friend"})]})})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"This action is permanent and cannot be undone. Consider blocking instead if you want to avoid future contact."})})]})})}function FriendOptionsModal(e){let{friend:r,onClose:t,onStartChat:l,onUnfriend:n}=e,[i,d]=(0,s.useState)(!1),handleUnfriendConfirm=async e=>{await n(e),d(!1),t()};return i?(0,a.jsx)(UnfriendConfirmationModal,{friend:r,onClose:()=>d(!1),onConfirm:handleUnfriendConfirm}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold shadow-lg",children:r.fullName.charAt(0).toUpperCase()}),"online"===r.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:r.fullName}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["@",r.username]})]})]}),(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:t,className:"p-2 hover:bg-white/50 dark:hover:bg-gray-700 rounded-full",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]})}),(0,a.jsxs)("div",{className:"p-4 space-y-2",children:[(0,a.jsx)(c,{onClick:()=>{l(r),t()},className:"w-full justify-start h-14 px-4 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white transition-all duration-300 hover:shadow-lg hover:scale-105",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-white/20",children:(0,a.jsx)(L.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Send Message"}),(0,a.jsx)("div",{className:"text-xs opacity-90",children:"Start a conversation"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)(c,{variant:"outline",className:"h-14 flex-col space-y-1 border-gray-300 hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 hover:scale-105",children:[(0,a.jsx)(K.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-xs",children:"Call"})]}),(0,a.jsxs)(c,{variant:"outline",className:"h-14 flex-col space-y-1 border-gray-300 hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 hover:scale-105",children:[(0,a.jsx)(Q.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-xs",children:"Video"})]})]}),(0,a.jsx)("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(et.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Friends"}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("online"===r.status?"bg-green-400 animate-pulse":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-green-700 dark:text-green-300 capitalize",children:r.status})]})}),(0,a.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,a.jsx)(c,{variant:"outline",className:"w-full justify-start h-12 px-4 rounded-xl border-gray-300 hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition-all duration-300",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(I.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Friend Settings"})]})}),(0,a.jsx)(c,{onClick:()=>d(!0),variant:"outline",className:"w-full justify-start h-12 px-4 rounded-xl border-red-300 text-red-600 hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 transition-all duration-300 hover:scale-105",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Remove Friend"})]})})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsx)("div",{className:"flex items-center justify-center text-xs text-gray-500 dark:text-gray-400",children:(0,a.jsxs)("span",{children:["Friends since joining • ","online"===r.status?"Active now":"Last seen recently"]})})})]})})}function ChatWindow(e){var r;let{chat:t,messages:l,currentUser:n,onSendMessage:i,onBack:d,isMobile:o=!1,onTyping:m,typingUsers:h=[],onUnfriend:g}=e,[u,f]=(0,s.useState)(""),[b,p]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),w=(0,s.useRef)(null),k=(0,s.useRef)();(0,s.useEffect)(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[l]),(0,s.useEffect)(()=>(m&&(u.trim()&&!b?(p(!0),m(!0)):!u.trim()&&b&&(p(!1),m(!1)),k.current&&clearTimeout(k.current),u.trim()&&(k.current=setTimeout(()=>{p(!1),m(!1)},3e3))),()=>{k.current&&clearTimeout(k.current)}),[u,b,m]),(0,s.useEffect)(()=>()=>{m&&b&&m(!1)},[]);let handleSendMessage=async e=>{if(e.preventDefault(),!u.trim())return;let r=u.trim();f(""),m&&b&&(p(!1),m(!1));try{await i(r)}catch(e){console.error("Failed to send message:",e),f(r)}},getChatTitle=()=>{var e;return"group"===t.type?t.name:(null===(e=t.participant)||void 0===e?void 0:e.fullName)||t.name};return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[o&&d&&(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:d,className:"p-2 flex-shrink-0",children:(0,a.jsx)(H.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ".concat("group"===t.type?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-cyan-500"),children:"group"===t.type?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}):getChatTitle().charAt(0).toUpperCase()}),"direct"===t.type&&(null===(r=t.participant)||void 0===r?void 0:r.status)==="online"&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 ".concat("group"===t.type||"direct"===t.type?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg p-2 -m-2 transition-colors":""),onClick:()=>{"group"===t.type&&t.group?v(!0):"direct"===t.type&&t.participant&&N(!0)},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h2",{className:"font-semibold text-gray-900 dark:text-white truncate",children:getChatTitle()}),"group"===t.type&&(0,a.jsx)(F.Z,{className:"w-4 h-4 text-gray-400"}),"direct"===t.type&&(0,a.jsx)(J.Z,{className:"w-4 h-4 text-gray-400"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(()=>{var e,r,a;if("group"===t.type){let e=(null===(a=t.group)||void 0===a?void 0:null===(r=a.members)||void 0===r?void 0:r.length)||0;return"".concat(e," members")}return(null===(e=t.participant)||void 0===e?void 0:e.status)==="online"?"Online":"Last seen recently"})()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(K.Z,{className:"w-5 h-5"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(Q.Z,{className:"w-5 h-5"})}),(0,a.jsx)(c,{variant:"ghost",size:"sm",className:"p-2",children:(0,a.jsx)(J.Z,{className:"w-5 h-5"})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900",children:0===l.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"w-20 h-20 mb-4 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/20 dark:to-purple-900/20 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,a.jsx)("p",{className:"text-center font-medium",children:"Start the conversation"}),(0,a.jsxs)("p",{className:"text-sm text-center mt-1",children:["Send a message to begin chatting with ",getChatTitle()]})]}):(0,a.jsxs)(a.Fragment,{children:[l.map((e,r)=>{let t=e.senderId===n.id,s=0===r||l[r-1].senderId!==e.senderId,i=r===l.length-1||l[r+1].senderId!==e.senderId||new Date(l[r+1].timestamp).getTime()-new Date(e.timestamp).getTime()>3e5;return(0,a.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-end space-x-2 max-w-xs lg:max-w-md ".concat(t?"flex-row-reverse space-x-reverse":""),children:[!t&&s&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",children:e.senderName.charAt(0).toUpperCase()}),!t&&!s&&(0,a.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[!t&&s&&(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 px-3",children:e.senderName}),(0,a.jsx)("div",{className:"px-4 py-2 rounded-2xl shadow-sm ".concat(t?"bg-blue-500 text-white rounded-br-md":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-600 rounded-bl-md"),children:(0,a.jsx)("p",{className:"text-sm leading-relaxed break-words",children:e.content})}),i&&(0,a.jsx)("span",{className:"text-xs text-gray-400 mt-1 ".concat(t?"text-right":"text-left"," px-3"),children:(0,Y.Z)(new Date(e.timestamp),{addSuffix:!0})})]})]})},e.id)}),h.length>0&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex items-end space-x-2 max-w-xs lg:max-w-md",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 px-4 py-3 rounded-2xl rounded-bl-md shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:0===h.length?null:1===h.length?"Someone is typing...":"".concat(h.length," people are typing...")})]})})]})}),(0,a.jsx)("div",{ref:w})]})}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[(0,a.jsxs)("form",{onSubmit:handleSendMessage,className:"flex items-end space-x-3",children:[(0,a.jsx)(c,{type:"button",variant:"ghost",size:"sm",className:"p-2 flex-shrink-0",children:(0,a.jsx)(X.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(x,{value:u,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSendMessage(e))},placeholder:"Message ".concat(getChatTitle(),"..."),className:"pr-12 py-3 rounded-2xl border-gray-300 dark:border-gray-600 focus:border-blue-500 dark:focus:border-blue-400 resize-none",disabled:!1}),(0,a.jsx)(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1",children:(0,a.jsx)($.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)(c,{type:"submit",disabled:!u.trim(),className:"p-3 rounded-full bg-blue-500 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:(0,a.jsx)(ee.Z,{className:"w-5 h-5"})})]}),b&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-1 mr-2",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),"You are typing..."]})]}),y&&"group"===t.type&&t.group&&(0,a.jsx)(GroupMembersModal,{group:t.group,onClose:()=>v(!1),currentUserId:n.id}),j&&"direct"===t.type&&t.participant&&g&&(0,a.jsx)(FriendOptionsModal,{friend:t.participant,onClose:()=>N(!1),onStartChat:()=>{N(!1)},onUnfriend:async e=>{await g(e),N(!1)}})]})}var el=t(4527);function FriendsList(e){let{friends:r,onAddFriend:t,onStartChat:s}=e;return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Friends"}),(0,a.jsxs)(c,{onClick:t,size:"sm",children:[(0,a.jsx)(el.Z,{className:"w-4 h-4 mr-2"}),"Add Friend"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:0===r.length?(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,a.jsx)("p",{children:"No friends yet. Add some friends to start chatting!"})}):r.map(e=>(0,a.jsx)("div",{className:"p-3 rounded-lg border border-gray-200 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold",children:e.fullName.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:e.fullName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("online"===e.status?"bg-green-500":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-gray-500 capitalize",children:e.status})]})]})]}),(0,a.jsx)(c,{onClick:()=>s(e),size:"sm",variant:"outline",children:(0,a.jsx)(L.Z,{className:"w-4 h-4"})})]})},e.id))})]})}var en=t(9883);function GroupsList(e){let{groups:r,friends:t,onCreateGroup:s,onSelectGroup:l}=e,getFriendName=e=>{let r=t.find(r=>r.id===e);return r?r.fullName:"Unknown"};return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Groups"}),(0,a.jsxs)(c,{onClick:s,size:"sm",children:[(0,a.jsx)(en.Z,{className:"w-4 h-4 mr-2"}),"Create Group"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:0===r.length?(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,a.jsx)("p",{children:"No groups yet. Create a group to chat with multiple friends!"})}):r.map(e=>{var r,t;return(0,a.jsx)("div",{className:"p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>l(e),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-500 rounded-full flex items-center justify-center text-white",children:(0,a.jsx)(F.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[null===(r=e.members)||void 0===r?void 0:r.length," members"]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:["Members: ",null===(t=e.members)||void 0===t?void 0:t.map(e=>getFriendName(e)).join(", ")]})]})]})},e.id)})})]})}var ei=t(8835),ed=t(2442);let eo=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(ei.fC,{ref:r,className:cn("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:(0,a.jsx)(ei.z$,{className:cn("flex items-center justify-center text-current"),children:(0,a.jsx)(ed.Z,{className:"h-4 w-4"})})})});eo.displayName=ei.fC.displayName;var ec=t(1045);let ex=ec.fC;ec.xz;let em=ec.h_;ec.x8;let eh=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(ec.aV,{ref:r,className:cn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s})});eh.displayName=ec.aV.displayName;let eg=s.forwardRef((e,r)=>{let{className:t,children:s,...l}=e;return(0,a.jsxs)(em,{children:[(0,a.jsx)(eh,{}),(0,a.jsxs)(ec.VY,{ref:r,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[s,(0,a.jsxs)(ec.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eg.displayName=ec.VY.displayName;let DialogHeader=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",r),...t})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};DialogFooter.displayName="DialogFooter";let eu=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(ec.Dx,{ref:r,className:cn("text-lg font-semibold leading-none tracking-tight",t),...s})});eu.displayName=ec.Dx.displayName;let ef=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(ec.dk,{ref:r,className:cn("text-sm text-muted-foreground",t),...s})});function CreateGroupModal(e){let{friends:r,onClose:t,onCreateGroup:l}=e,[n,i]=(0,s.useState)(""),[d,o]=(0,s.useState)([]),handleMemberToggle=e=>{o(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])};return(0,a.jsx)(ex,{open:!0,onOpenChange:t,children:(0,a.jsxs)(eg,{className:"sm:max-w-md",children:[(0,a.jsx)(DialogHeader,{children:(0,a.jsx)(eu,{children:"Create New Group"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{htmlFor:"groupName",children:"Group Name"}),(0,a.jsx)(x,{id:"groupName",value:n,onChange:e=>i(e.target.value),placeholder:"Enter group name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{children:"Select Members"}),(0,a.jsx)("div",{className:"mt-2 space-y-2 max-h-48 overflow-y-auto",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eo,{id:"friend-".concat(e.id),checked:d.includes(e.id),onCheckedChange:()=>handleMemberToggle(e.id)}),(0,a.jsxs)(C,{htmlFor:"friend-".concat(e.id),className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white text-xs font-semibold",children:e.fullName.charAt(0)}),(0,a.jsx)("span",{children:e.fullName})]})]},e.id))})]})]}),(0,a.jsxs)(DialogFooter,{children:[(0,a.jsx)(c,{variant:"outline",onClick:t,children:"Cancel"}),(0,a.jsx)(c,{onClick:()=>{n.trim()&&d.length>0&&(l({name:n.trim(),members:d}),t())},disabled:!n.trim()||0===d.length,children:"Create Group"})]})]})})}ef.displayName=ec.dk.displayName;var eb=t(6141),ep=t(2851),ey=t(5340),ev=t(1981);function AddFriendModal(e){let{onClose:r,onFriendRequestSent:t}=e,[l,n]=(0,s.useState)(""),[i,d]=(0,s.useState)([]),[o,m]=(0,s.useState)([]),[h,g]=(0,s.useState)(!1),[u,f]=(0,s.useState)(new Set),[b,p]=(0,s.useState)(new Set),[y,v]=(0,s.useState)("search"),j=(0,s.useRef)();(0,s.useEffect)(()=>{loadSuggestions(""),loadPendingRequests()},[]),(0,s.useEffect)(()=>(j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{loadSuggestions(l)},300),()=>{j.current&&clearTimeout(j.current)}),[l]);let loadSuggestions=async e=>{try{g(!0);let r=await fetch("/api/friends/suggestions?query=".concat(encodeURIComponent(e)));if(r.ok){let e=await r.json();d(e)}}catch(e){console.error("Failed to load suggestions:",e)}finally{g(!1)}},loadPendingRequests=async()=>{try{let e=await fetch("/api/friends/requests");if(e.ok){let r=await e.json();m(r.outgoing||[])}}catch(e){console.error("Failed to load pending requests:",e)}},handleSendFriendRequest=async e=>{if(!(u.has(e.id)||b.has(e.id)))try{f(r=>new Set(r).add(e.id));let r=await fetch("/api/friends/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})});if(r.ok)p(r=>new Set(r).add(e.id)),t(),loadPendingRequests();else{let e=await r.json();console.error("Failed to send friend request:",e.error)}}catch(e){console.error("Failed to send friend request:",e)}finally{f(r=>{let t=new Set(r);return t.delete(e.id),t})}},handleCancelRequest=async e=>{try{let r=await fetch("/api/friends/requests/".concat(e.id,"/cancel"),{method:"DELETE"});r.ok&&(m(r=>r.filter(r=>r.id!==e.id)),t())}catch(e){console.error("Failed to cancel friend request:",e)}},getSuggestionIcon=e=>{switch(e){case"mutual":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-blue-500"});case"active":return(0,a.jsx)(eb.Z,{className:"w-4 h-4 text-green-500"});case"search":return(0,a.jsx)(V.Z,{className:"w-4 h-4 text-purple-500"});default:return(0,a.jsx)(ep.Z,{className:"w-4 h-4 text-yellow-500"})}},getSuggestionColor=e=>{switch(e){case"mutual":return"from-blue-500 to-cyan-500";case"active":return"from-green-500 to-emerald-500";case"search":return"from-purple-500 to-pink-500";default:return"from-yellow-500 to-orange-500"}},N=i.reduce((e,r)=>(e[r.suggestionType]||(e[r.suggestionType]=[]),e[r.suggestionType].push(r),e),{}),getSectionTitle=e=>{switch(e){case"search":return"Search Results";case"mutual":return"People You May Know";case"active":return"Recently Active";default:return"Suggested for You"}},getButtonContent=e=>b.has(e.id)?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Sent"})]}):u.has(e.id)?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Sending..."})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ee.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Send Request"})]}),getButtonStyle=e=>b.has(e.id)?"px-4 py-2 bg-green-500 text-white rounded-lg font-medium cursor-default":"px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-300 hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(el.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Add Friends"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send friend requests to connect"})]})]}),(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:r,className:"p-2 hover:bg-white/50 dark:hover:bg-gray-700 rounded-full",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:()=>v("search"),className:"flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ".concat("search"===y?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(V.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Find Friends"})]})}),(0,a.jsx)("button",{onClick:()=>v("pending"),className:"flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 relative ".concat("pending"===y?"bg-white dark:bg-gray-600 text-orange-600 dark:text-orange-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(eb.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Pending Requests"}),o.length>0&&(0,a.jsx)(Badge,{className:"bg-orange-500 text-white border-0 text-xs min-w-[20px] h-5",children:o.length})]})})]}),"search"===y&&(0,a.jsxs)("div",{className:"relative mt-4",children:[(0,a.jsx)(V.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(x,{value:l,onChange:e=>n(e.target.value),placeholder:"Search by username or name...",className:"pl-10 pr-4 py-3 rounded-xl border-gray-300 dark:border-gray-600 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700"}),h&&(0,a.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})]}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96 p-6",children:"search"===y?0!==i.length||h?(0,a.jsx)("div",{className:"space-y-8",children:Object.entries(N).map(e=>{let[r,t]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[getSuggestionIcon(r),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:getSectionTitle(r)})]}),(0,a.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-gray-200 to-transparent dark:from-gray-600"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-full",children:t.length})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(e=>(0,a.jsx)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:shadow-lg transition-all duration-300 hover:border-blue-300 dark:hover:border-blue-600 bg-white dark:bg-gray-800 group",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br ".concat(getSuggestionColor(e.suggestionType)," rounded-full flex items-center justify-center text-white font-semibold shadow-lg group-hover:scale-105 transition-transform"),children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse",children:(0,a.jsx)("div",{className:"w-full h-full bg-green-400 rounded-full animate-ping"})}),"mutual"===e.suggestionType&&e.mutualFriends>0&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 border-2 border-white dark:border-gray-800 rounded-full flex items-center justify-center",children:(0,a.jsx)(ey.Z,{className:"w-2 h-2 text-white"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.fullName}),"online"===e.status&&(0,a.jsx)(Badge,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0 text-xs",children:"Online"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[getSuggestionIcon(e.suggestionType),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.reason})]})]}),(0,a.jsx)(c,{onClick:()=>handleSendFriendRequest(e),disabled:u.has(e.id)||b.has(e.id),className:getButtonStyle(e),children:getButtonContent(e)})]})},e.id))})]},r)})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(V.Z,{className:"w-10 h-10 text-gray-400"})}),(0,a.jsx)("p",{className:"text-center font-medium",children:l?"No users found":"Start typing to search for friends"}),(0,a.jsx)("p",{className:"text-sm text-center mt-1",children:l?"Try a different search term":"Or browse our suggestions below"})]}):0===o.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(eb.Z,{className:"w-10 h-10 text-orange-500"})}),(0,a.jsx)("p",{className:"text-center font-medium",children:"No pending requests"}),(0,a.jsx)("p",{className:"text-sm text-center mt-1",children:"All your friend requests have been responded to"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,a.jsx)(ev.Z,{className:"w-5 h-5 text-orange-500"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Waiting for Response"}),(0,a.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-gray-200 to-transparent dark:from-gray-600"}),(0,a.jsxs)(Badge,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400 border-0",children:[o.length," pending"]})]}),o.map(e=>(0,a.jsx)("div",{className:"p-4 border border-orange-200 dark:border-orange-800 rounded-xl bg-orange-50 dark:bg-orange-900/10 hover:shadow-lg transition-all duration-300",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-full flex items-center justify-center text-white font-semibold shadow-lg",children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"}),(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-orange-500 border-2 border-white dark:border-gray-800 rounded-full flex items-center justify-center",children:(0,a.jsx)(eb.Z,{className:"w-2 h-2 text-white"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.fullName}),(0,a.jsx)(Badge,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400 border-0 text-xs",children:"Pending"}),"online"===e.status&&(0,a.jsx)(Badge,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0 text-xs",children:"Online"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[(0,a.jsx)(eb.Z,{className:"w-3 h-3 text-orange-500"}),(0,a.jsxs)("span",{className:"text-xs text-orange-600 dark:text-orange-400",children:["Sent ",new Date(e.createdAt).toLocaleDateString()]})]})]}),(0,a.jsx)(c,{onClick:()=>handleCancelRequest(e),variant:"outline",className:"px-4 py-2 border-orange-300 text-orange-600 hover:bg-orange-50 dark:border-orange-600 dark:text-orange-400 dark:hover:bg-orange-900/20 rounded-lg font-medium transition-all duration-300 hover:scale-105",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Cancel"})]})})]})},e.id))]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(ee.Z,{className:"w-3 h-3 text-blue-500"}),(0,a.jsx)("span",{children:"Send friend requests"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(et.Z,{className:"w-3 h-3 text-green-500"}),(0,a.jsx)("span",{children:"Wait for acceptance"})]})]}),(0,a.jsx)("span",{children:"search"===y?"".concat(i.length," suggestions • ").concat(b.size," requests sent"):"".concat(o.length," pending requests")})]})})]})})}function SearchBar(e){let{searchQuery:r,onSearchChange:t}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(V.Z,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search conversations...",value:r,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-10 py-2 bg-gray-100 dark:bg-gray-700 border-0 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-gray-600 transition-colors"}),r&&(0,a.jsx)("button",{onClick:()=>t(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,a.jsx)(A.Z,{className:"h-4 w-4 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"})})]})}function ChatList(e){let{chats:r,selectedChat:t,onSelectChat:s,searchQuery:l,typingUsers:n={}}=e;return 0===r.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-center",children:l?"No chats match your search":"No conversations yet"}),(0,a.jsx)("p",{className:"text-sm text-center mt-1",children:l?"Try a different search term":"Start a conversation with friends or create a group"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.map(e=>{var r,l,i;let d=(null==t?void 0:t.id)===e.id,o=n[e.id]&&n[e.id].length>0,c=e.unreadCount>0;return(0,a.jsx)("div",{onClick:()=>s(e),className:"p-4 cursor-pointer transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 ".concat(d?"bg-blue-50 dark:bg-blue-900/20 border-r-4 border-blue-500":c?"bg-blue-25 dark:bg-blue-950/10":""),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold ".concat("group"===e.type?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-cyan-500"),children:"group"===e.type?(0,a.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}):e.name.charAt(0).toUpperCase()}),"direct"===e.type&&(null===(r=e.participant)||void 0===r?void 0:r.status)==="online"&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"}),c&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 border-2 border-white dark:border-gray-800 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h3",{className:"font-semibold truncate ".concat(c?"text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300"),children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&(0,a.jsx)(Badge,{className:"bg-red-500 text-white border-0 shadow-lg shadow-red-500/25 animate-pulse font-bold text-xs min-w-[20px] h-5",children:e.unreadCount>99?"99+":e.unreadCount}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 flex-shrink-0",children:(0,Y.Z)(new Date(e.timestamp),{addSuffix:!0})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm truncate ".concat(o?"text-blue-500 dark:text-blue-400 italic animate-pulse":c?"text-gray-900 dark:text-gray-200 font-medium":"text-gray-500 dark:text-gray-400"),children:o?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsxs)("span",{className:"flex space-x-1 mr-2",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(null===(l=n[e.id])||void 0===l?void 0:l.length)===1?"Someone is typing...":"Multiple people are typing..."]}):e.lastMessage||"No messages yet"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:["direct"===e.type&&(null===(i=e.participant)||void 0===i?void 0:i.status)==="online"&&(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",title:"Online"}),c&&(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",title:"New messages"})]})]})]})]})},e.id)})})}function OnlineFriends(e){let{friends:r,onStartChat:t}=e;return 0===r.length?null:(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Online Friends"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.length," online"]})]}),(0,a.jsx)("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:r.map(e=>(0,a.jsxs)("button",{onClick:()=>t(e),className:"flex-shrink-0 flex flex-col items-center space-y-1 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:e.fullName.charAt(0).toUpperCase()}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"})]}),(0,a.jsx)("span",{className:"text-xs text-gray-700 dark:text-gray-300 text-center max-w-[60px] truncate",children:e.fullName.split(" ")[0]})]},e.id))})]})}var ej=t(8004);function MobileHeader(e){var r;let{currentUser:t,activeView:s,selectedChat:l,onMenuClick:n,onBack:i,showMobileSidebar:d=!1}=e;return(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 z-40 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between md:hidden",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:i,className:"p-2 -ml-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,a.jsx)(H.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 ml-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:"group"===l.type?(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}):l.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white text-sm",children:l.name}),"direct"===l.type&&(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:(null===(r=l.participant)||void 0===r?void 0:r.status)==="online"?"Online":"Last seen recently"})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:n,className:"p-2 -ml-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:d?(0,a.jsx)(A.Z,{className:"w-5 h-5"}):(0,a.jsx)(ej.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("h1",{className:"font-semibold text-gray-900 dark:text-white",children:["chats"===s&&"Chats","friends"===s&&"Friends","groups"===s&&"Groups"]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-xs",children:t.fullName.charAt(0).toUpperCase()})]})})}var eN=t(1271),ew=t(5817),ek=t(2601);function usePWA(){let[e,r]=(0,s.useState)({isInstallable:!1,isInstalled:!1,isOnline:!0,isUpdateAvailable:!1}),[t,a]=(0,s.useState)(null);(0,s.useEffect)(()=>{let updateOnlineStatus=()=>{r(e=>({...e,isOnline:navigator.onLine}))},handleBeforeInstallPrompt=e=>{e.preventDefault(),a(e),r(e=>({...e,isInstallable:!0}))},handleAppInstalled=()=>{a(null),r(e=>({...e,isInstallable:!1,isInstalled:!0}))},registerServiceWorker=async()=>{if("serviceWorker"in navigator)try{let e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered:",e),e.addEventListener("updatefound",()=>{let t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&r(e=>({...e,isUpdateAvailable:!0}))})}),setInterval(()=>{e.update()},6e4)}catch(e){console.error("Service Worker registration failed:",e)}};return(()=>{let e=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");r(r=>({...r,isInstalled:e}))})(),updateOnlineStatus(),registerServiceWorker(),window.addEventListener("beforeinstallprompt",handleBeforeInstallPrompt),window.addEventListener("appinstalled",handleAppInstalled),window.addEventListener("online",updateOnlineStatus),window.addEventListener("offline",updateOnlineStatus),()=>{window.removeEventListener("beforeinstallprompt",handleBeforeInstallPrompt),window.removeEventListener("appinstalled",handleAppInstalled),window.removeEventListener("online",updateOnlineStatus),window.removeEventListener("offline",updateOnlineStatus)}},[]);let installApp=async()=>{if(!t)return!1;try{await t.prompt();let{outcome:e}=await t.userChoice;if("accepted"===e)return a(null),r(e=>({...e,isInstallable:!1,isInstalled:!0})),!0;return!1}catch(e){return console.error("Error installing app:",e),!1}},requestNotificationPermission=async()=>{if("Notification"in window){let e=await Notification.requestPermission();return"granted"===e}return!1},subscribeToPushNotifications=async()=>{if("serviceWorker"in navigator&&"PushManager"in window)try{let e=await navigator.serviceWorker.ready,r=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ek.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY});return await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),r}catch(e){console.error("Error subscribing to push notifications:",e)}return null};return{...e,installApp,updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{(null==e?void 0:e.waiting)&&(e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})},requestNotificationPermission,subscribeToPushNotifications}}function PWAInstallBanner(){let{isInstallable:e,isInstalled:r,installApp:t}=usePWA(),[l,n]=(0,s.useState)(!1);if(!e||r||l)return null;let handleInstall=async()=>{let e=await t();e||n(!0)};return(0,a.jsx)("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl shadow-2xl z-50 p-4 animate-slide-up",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(eN.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-bold text-lg",children:"Install Chattr by Justin"}),(0,a.jsx)("p",{className:"text-sm opacity-90",children:"Get the full app experience with offline support"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(c,{onClick:handleInstall,size:"sm",className:"bg-white text-blue-600 hover:bg-gray-100 font-semibold",children:[(0,a.jsx)(ew.Z,{className:"w-4 h-4 mr-2"}),"Install"]}),(0,a.jsx)(c,{onClick:()=>n(!0),size:"sm",variant:"ghost",className:"text-white hover:bg-white/20 p-2",children:(0,a.jsx)(A.Z,{className:"w-4 h-4"})})]})]})})}var eC=t(4280);function PWAUpdateBanner(){let{isUpdateAvailable:e,updateApp:r}=usePWA();return e?(0,a.jsx)("div",{className:"fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-green-500 text-white rounded-xl shadow-lg z-50 p-4 animate-slide-down",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(eC.Z,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Update Available"}),(0,a.jsx)("p",{className:"text-sm opacity-90",children:"A new version of Chattr is ready"})]}),(0,a.jsx)(c,{onClick:r,size:"sm",className:"bg-white text-green-600 hover:bg-gray-100 font-semibold",children:"Update"})]})}):null}function OfflineIndicator(){let{isOnline:e}=usePWA();return e?null:(0,a.jsxs)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded-full shadow-lg z-50 flex items-center space-x-2 animate-pulse",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"You're offline"})]})}function useWebSocket(e){let{currentUserId:r,onNewMessage:t,onUserStatusChange:a,onTypingUpdate:l,onMessageRead:n,enabled:i=!1}=e,d=(0,s.useRef)(null),[o,c]=(0,s.useState)(!1),[x,m]=(0,s.useState)(!1),h=(0,s.useRef)(),g=(0,s.useRef)(0),connect=()=>{if(!i){c(!1),m(!1);return}if(!x&&(!d.current||d.current.readyState!==WebSocket.CONNECTING))try{m(!0);let e="ws://localhost:8080/ws?userId=".concat(r);d.current=new WebSocket(e);let s=setTimeout(()=>{d.current&&d.current.readyState===WebSocket.CONNECTING&&(d.current.close(),m(!1),console.log("WebSocket connection timeout"))},5e3);d.current.onopen=()=>{console.log("WebSocket connected"),c(!0),m(!1),g.current=0,clearTimeout(s)},d.current.onmessage=e=>{try{let r=JSON.parse(e.data);switch(r.type){case"new_message":t(r.data);break;case"user_status":a(r.data.userId,r.data.status);break;case"typing":l(r.data.chatId,r.data.userId,r.data.isTyping);break;case"message_read":n(r.data.chatId,r.data.messageId)}}catch(e){console.error("Error parsing WebSocket message:",e)}},d.current.onclose=()=>{if(console.log("WebSocket disconnected"),c(!1),m(!1),clearTimeout(s),i&&g.current<3){g.current++;let e=Math.min(1e3*Math.pow(2,g.current),1e4);h.current=setTimeout(()=>{console.log("Attempting to reconnect... (".concat(g.current,"/").concat(3,")")),connect()},e)}else g.current>=3&&console.log("Max reconnection attempts reached. WebSocket disabled.")},d.current.onerror=e=>{console.error("WebSocket error:",e),m(!1),clearTimeout(s)}}catch(e){console.error("Failed to connect WebSocket:",e),m(!1)}},disconnect=()=>{h.current&&clearTimeout(h.current),d.current&&d.current.close(),c(!1),m(!1)},sendMessage=(e,r)=>!!d.current&&d.current.readyState===WebSocket.OPEN&&(d.current.send(JSON.stringify({type:e,data:r})),!0);return(0,s.useEffect)(()=>(i?connect():disconnect(),disconnect),[r,i]),{isConnected:o,isConnecting:x,sendTyping:(e,r)=>sendMessage("typing",{chatId:e,isTyping:r}),markMessageAsRead:(e,r)=>sendMessage("message_read",{chatId:e,messageId:r}),reconnect:connect,enabled:i}}function useNotifications(){let[e,r]=(0,s.useState)("default");(0,s.useEffect)(()=>{"Notification"in window&&r(Notification.permission)},[]);let t=(0,s.useCallback)(async()=>{if("Notification"in window&&"default"===Notification.permission){let e=await Notification.requestPermission();return r(e),e}return e},[e]),a=(0,s.useCallback)((e,r,t)=>{if("Notification"in window&&"granted"===Notification.permission){let a=new Notification(e,{body:r,tag:t,icon:"/favicon.ico",badge:"/favicon.ico",requireInteraction:!1,silent:!1});return setTimeout(()=>{a.close()},5e3),a}},[]);return{permission:e,requestPermission:t,showNotification:a,isSupported:"Notification"in window}}var eS=t(2104);function FriendRequestsModal(e){let{onClose:r,onRequestHandled:t}=e,[l,n]=(0,s.useState)({incoming:[],outgoing:[]}),[i,d]=(0,s.useState)(!0),[o,x]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{loadRequests()},[]);let loadRequests=async()=>{try{d(!0);let e=await fetch("/api/friends/requests");if(e.ok){let r=await e.json();n(r)}}catch(e){console.error("Failed to load friend requests:",e)}finally{d(!1)}},handleAcceptRequest=async e=>{if(!o.has(e.id))try{x(r=>new Set(r).add(e.id));let r=await fetch("/api/friends/requests/".concat(e.id,"/accept"),{method:"POST"});r.ok&&(n(r=>({...r,incoming:r.incoming.filter(r=>r.id!==e.id)})),t())}catch(e){console.error("Failed to accept friend request:",e)}finally{x(r=>{let t=new Set(r);return t.delete(e.id),t})}},handleRejectRequest=async e=>{if(!o.has(e.id))try{x(r=>new Set(r).add(e.id));let r=await fetch("/api/friends/requests/".concat(e.id,"/reject"),{method:"POST"});r.ok&&(n(r=>({...r,incoming:r.incoming.filter(r=>r.id!==e.id)})),t())}catch(e){console.error("Failed to reject friend request:",e)}finally{x(r=>{let t=new Set(r);return t.delete(e.id),t})}},handleCancelRequest=async e=>{if(!o.has(e.id))try{x(r=>new Set(r).add(e.id));let r=await fetch("/api/friends/requests/".concat(e.id,"/cancel"),{method:"DELETE"});r.ok&&(n(r=>({...r,outgoing:r.outgoing.filter(r=>r.id!==e.id)})),t())}catch(e){console.error("Failed to cancel friend request:",e)}finally{x(r=>{let t=new Set(r);return t.delete(e.id),t})}},m=l.incoming.length+l.outgoing.length;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(F.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Friend Requests"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:0===m?"No pending requests":"".concat(m," pending request").concat(m>1?"s":"")})]})]}),(0,a.jsx)(c,{variant:"ghost",size:"sm",onClick:r,className:"p-2 hover:bg-white/50 dark:hover:bg-gray-700 rounded-full",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96",children:i?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):0===m?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(F.Z,{className:"w-10 h-10 text-gray-400"})}),(0,a.jsx)("p",{className:"text-center font-medium",children:"No friend requests"}),(0,a.jsx)("p",{className:"text-sm text-center mt-1",children:"All caught up! No pending friend requests at the moment."})]}):(0,a.jsxs)("div",{className:"p-6 space-y-8",children:[l.incoming.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(et.Z,{className:"w-5 h-5 text-green-500"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Incoming Requests"})]}),(0,a.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-gray-200 to-transparent dark:from-gray-600"}),(0,a.jsx)(Badge,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0",children:l.incoming.length})]}),(0,a.jsx)("div",{className:"space-y-4",children:l.incoming.map(e=>(0,a.jsx)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:shadow-lg transition-all duration-300 hover:border-green-300 dark:hover:border-green-600 bg-white dark:bg-gray-800",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white font-semibold shadow-lg",children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.fullName}),"online"===e.status&&(0,a.jsx)(Badge,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0 text-xs",children:"Online"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[(0,a.jsx)(eb.Z,{className:"w-3 h-3 text-gray-400"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:(0,Y.Z)(new Date(e.createdAt),{addSuffix:!0})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c,{onClick:()=>handleAcceptRequest(e),disabled:o.has(e.id),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white rounded-lg font-medium transition-all duration-300 hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:o.has(e.id)?(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Accept"})]})}),(0,a.jsx)(c,{onClick:()=>handleRejectRequest(e),disabled:o.has(e.id),variant:"outline",className:"px-4 py-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 rounded-lg font-medium transition-all duration-300 hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:o.has(e.id)?(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-red-500 border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eS.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Reject"})]})})]})]})},e.id))})]}),l.outgoing.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ee.Z,{className:"w-5 h-5 text-blue-500"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Sent Requests"})]}),(0,a.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-gray-200 to-transparent dark:from-gray-600"}),(0,a.jsx)(Badge,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-0",children:l.outgoing.length})]}),(0,a.jsx)("div",{className:"space-y-4",children:l.outgoing.map(e=>(0,a.jsx)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:shadow-lg transition-all duration-300 hover:border-blue-300 dark:hover:border-blue-600 bg-white dark:bg-gray-800",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-semibold shadow-lg",children:e.fullName.charAt(0).toUpperCase()}),"online"===e.status&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.fullName}),(0,a.jsx)(Badge,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-0 text-xs",children:"Pending"}),"online"===e.status&&(0,a.jsx)(Badge,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0 text-xs",children:"Online"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[(0,a.jsx)(eb.Z,{className:"w-3 h-3 text-gray-400"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Sent ",(0,Y.Z)(new Date(e.createdAt),{addSuffix:!0})]})]})]}),(0,a.jsx)(c,{onClick:()=>handleCancelRequest(e),disabled:o.has(e.id),variant:"outline",className:"px-4 py-2 border-gray-300 text-gray-600 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-700 rounded-lg font-medium transition-all duration-300 hover:shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:o.has(e.id)?(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-gray-500 border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Cancel"})]})})]})},e.id))})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(U.Z,{className:"w-3 h-3 text-green-500"}),(0,a.jsx)("span",{children:"Accept or reject incoming requests"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(eb.Z,{className:"w-3 h-3 text-blue-500"}),(0,a.jsx)("span",{children:"Cancel sent requests"})]})]}),(0,a.jsxs)("span",{children:[l.incoming.length," incoming • ",l.outgoing.length," outgoing"]})]})})]})})}function MessengerApp(e){var r;let{currentUser:t,onLogout:l}=e,[n,i]=(0,s.useState)("chats"),[d,o]=(0,s.useState)(null),[c,x]=(0,s.useState)([]),[m,h]=(0,s.useState)([]),[g,u]=(0,s.useState)([]),[f,b]=(0,s.useState)([]),[p,y]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[S,Z]=(0,s.useState)(!1),[T,M]=(0,s.useState)(!0),[L,F]=(0,s.useState)({}),[E,A]=(0,s.useState)(!1),[R,z]=(0,s.useState)(!1),{isInstalled:I,requestNotificationPermission:q,subscribeToPushNotifications:O}=usePWA(),{showNotification:U}=useNotifications();(0,s.useEffect)(()=>{let setupNotifications=async()=>{let e=await q();e&&I&&await O()};setupNotifications()},[I]);let{isConnected:D,isConnecting:B,sendTyping:W,markMessageAsRead:P}=useWebSocket({currentUserId:t.id,enabled:E,onNewMessage:e=>{if(b(r=>[...r,e]),u(r=>r.map(r=>r.id===e.chatId?{...r,lastMessage:e.content,timestamp:e.timestamp,unreadCount:(null==d?void 0:d.id)===e.chatId?0:r.unreadCount+1}:r).sort((e,r)=>new Date(r.timestamp).getTime()-new Date(e.timestamp).getTime())),(null==d?void 0:d.id)!==e.chatId){let r=g.find(r=>r.id===e.chatId);U("New message from ".concat(e.senderName),e.content,(null==r?void 0:r.type)==="group"?r.name:e.senderName)}playNotificationSound()},onUserStatusChange:(e,r)=>{x(t=>t.map(t=>t.id===e?{...t,status:r}:t))},onTypingUpdate:(e,r,t)=>{F(a=>{let s=a[e]||[];return t?{...a,[e]:[...s.filter(e=>e!==r),r]}:{...a,[e]:s.filter(e=>e!==r)}})},onMessageRead:(e,r)=>{console.log("Message ".concat(r," read in chat ").concat(e))}}),playNotificationSound=()=>{try{let e=new Audio("/notification.mp3");e.volume=.3,e.play().catch(e=>console.log("Could not play notification sound:",e))}catch(e){console.log("Notification sound not available")}};(0,s.useEffect)(()=>{let checkMobile=()=>{C(window.innerWidth<768)};return checkMobile(),window.addEventListener("resize",checkMobile),()=>window.removeEventListener("resize",checkMobile)},[]),(0,s.useEffect)(()=>{let handleEscape=e=>{"Escape"===e.key&&Z(!1)};return S?(document.addEventListener("keydown",handleEscape),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",handleEscape),document.body.style.overflow="unset"}},[S]),(0,s.useEffect)(()=>{let loadData=async()=>{try{M(!0);let[e,r,t]=await Promise.all([fetch("/api/friends"),fetch("/api/groups"),fetch("/api/chats")]);if(e.ok){let r=await e.json();x(r)}if(r.ok){let e=await r.json();h(e)}if(t.ok){let e=await t.json();u(e.sort((e,r)=>new Date(r.timestamp).getTime()-new Date(e.timestamp).getTime()))}}catch(e){console.error("Failed to load data:",e)}finally{M(!1)}};loadData()},[]),(0,s.useEffect)(()=>{let loadMessages=async()=>{if(d)try{let e=await fetch("/api/chats/".concat(d.id,"/messages"));if(e.ok){let r=await e.json();if(b(r),r.length>0&&D){let e=r[r.length-1];P(d.id,e.id)}}}catch(e){console.error("Failed to load messages:",e)}};loadMessages()},[d,D]);let handleSendMessage=async e=>{if(d)try{let r=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:d.id,content:e})});if(r.ok){let t=await r.json();D||b(e=>[...e,t]),u(r=>r.map(r=>r.id===d.id?{...r,lastMessage:e,timestamp:t.timestamp,unreadCount:0}:r).sort((e,r)=>new Date(r.timestamp).getTime()-new Date(e.timestamp).getTime()))}}catch(e){console.error("Failed to send message:",e)}},handleUnfriend=async e=>{try{let t=await fetch("/api/friends/".concat(e,"/unfriend"),{method:"DELETE"});if(t.ok){var r;x(r=>r.filter(r=>r.id!==e)),u(r=>r.filter(r=>{var t;return"direct"!==r.type||(null===(t=r.participant)||void 0===t?void 0:t.id)!==e})),(null==d?void 0:d.type)==="direct"&&(null===(r=d.participant)||void 0===r?void 0:r.id)===e&&o(null),console.log("Friend removed successfully")}else{let e=await t.json();throw Error(e.error||"Failed to remove friend")}}catch(e){throw console.error("Failed to remove friend:",e),e}},handleCreateGroup=async e=>{try{let r=await fetch("/api/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok){let e=await r.json();h(r=>[...r,e]);let t=await fetch("/api/chats");if(t.ok){let e=await t.json();u(e.sort((e,r)=>new Date(r.timestamp).getTime()-new Date(e.timestamp).getTime()))}}}catch(e){console.error("Failed to create group:",e)}},G=g.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())||e.lastMessage.toLowerCase().includes(N.toLowerCase())),V=c.filter(e=>e.fullName.toLowerCase().includes(N.toLowerCase())||e.username.toLowerCase().includes(N.toLowerCase())),_=m.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())),Y=c.filter(e=>"online"===e.status),H=g.reduce((e,r)=>e+r.unreadCount,0),handleSelectChat=e=>{o(e),Z(!1),u(r=>r.map(r=>r.id===e.id?{...r,unreadCount:0}:r))},handleBackToList=()=>{o(null)},handleStartChatWithFriend=e=>{let r=g.find(r=>{var t;return"direct"===r.type&&(null===(t=r.participant)||void 0===t?void 0:t.id)===e.id});r&&(handleSelectChat(r),i("chats"))},handleCloseMobileSidebar=()=>{Z(!1)},handleLogout=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),l()}catch(e){console.error("Logout failed:",e),l()}};if(T)return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your conversations..."})]})});let J=k&&d,K=k&&!d,Q=E?D?"connected":B?"connecting":"disconnected":"disabled";return(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 relative",children:[(0,a.jsx)(PWAInstallBanner,{}),(0,a.jsx)(PWAUpdateBanner,{}),(0,a.jsx)(OfflineIndicator,{}),E&&!D&&(0,a.jsxs)("div",{className:"fixed top-4 right-4 z-50 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:B?"Connecting...":"Reconnecting..."})]}),k&&(0,a.jsx)(MobileHeader,{currentUser:t,activeView:n,selectedChat:d,onMenuClick:()=>{Z(!S)},onBack:handleBackToList,showMobileSidebar:S}),k&&S&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex",children:(0,a.jsxs)("div",{className:"flex w-full",children:[(0,a.jsx)(Sidebar,{currentUser:t,activeView:n,onViewChange:e=>{i(e),Z(!1)},onLogout:handleLogout,isMobile:!0,onClose:handleCloseMobileSidebar}),(0,a.jsx)("div",{className:"flex-1 bg-black bg-opacity-50 min-w-0",onClick:handleCloseMobileSidebar,onTouchStart:handleCloseMobileSidebar})]})}),!k&&(0,a.jsx)(DesktopSidebarV2,{currentUser:t,activeView:n,onViewChange:i,onLogout:handleLogout,unreadCount:H,onlineCount:Y.length,isConnected:"connected"===Q,connectionStatus:Q}),(0,a.jsxs)("div",{className:"flex-1 flex",children:[(0,a.jsxs)("div",{className:"w-full md:w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col ".concat(J?"hidden":"block"," ").concat(k?"pt-16":""),children:["chats"===n&&Y.length>0&&(0,a.jsx)(OnlineFriends,{friends:Y,onStartChat:handleStartChatWithFriend}),(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["chats"===n&&"Chats","friends"===n&&"Friends","groups"===n&&"Groups"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:["friends"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>z(!0),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative",title:"Friend Requests",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-5 5-5-5h5v-12a1 1 0 011-1h4a1 1 0 011 1v12z"})})}),(0,a.jsx)("button",{onClick:()=>j(!0),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Add Friend",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),"groups"===n&&(0,a.jsx)("button",{onClick:()=>y(!0),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Create Group",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]})]}),(0,a.jsx)(SearchBar,{searchQuery:N,onSearchChange:w})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["chats"===n&&(0,a.jsx)(ChatList,{chats:G,selectedChat:d,onSelectChat:handleSelectChat,searchQuery:N,typingUsers:E?L:{}}),"friends"===n&&(0,a.jsx)(FriendsList,{friends:V,onAddFriend:()=>j(!0),onStartChat:handleStartChatWithFriend,onUnfriend:handleUnfriend,searchQuery:N}),"groups"===n&&(0,a.jsx)(GroupsList,{groups:_,friends:c,onCreateGroup:()=>y(!0),onSelectGroup:e=>{let r=g.find(r=>{var t;return"group"===r.type&&(null===(t=r.group)||void 0===t?void 0:t.id)===e.id});r&&(handleSelectChat(r),i("chats"))},searchQuery:N})]})]}),(0,a.jsx)("div",{className:"flex-1 ".concat(K?"hidden":"block"," ").concat(k?"pt-16":""),children:d?(0,a.jsx)(ChatWindow,{chat:d,messages:(r=d.id,f.filter(e=>e.chatId===r)),currentUser:t,onSendMessage:handleSendMessage,onBack:k?handleBackToList:void 0,isMobile:k,onTyping:E?e=>W(d.id,e):void 0,typingUsers:E&&L[d.id]||[],onUnfriend:handleUnfriend}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-white dark:bg-gray-800",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto mb-8 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/20 dark:to-purple-900/20 rounded-3xl flex items-center justify-center shadow-lg",children:(0,a.jsx)("svg",{className:"w-16 h-16 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-3",children:"Ready to Chat?"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-6 leading-relaxed",children:"Select a conversation from the sidebar to start messaging, or create a new chat with friends and groups."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,a.jsx)("button",{onClick:()=>i("friends"),className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-medium transition-colors shadow-lg hover:shadow-xl",children:"Add Friends"}),(0,a.jsx)("button",{onClick:()=>i("groups"),className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors",children:"Create Group"})]})]})})})]}),p&&(0,a.jsx)(CreateGroupModal,{friends:c,onClose:()=>y(!1),onCreateGroup:handleCreateGroup}),v&&(0,a.jsx)(AddFriendModal,{onClose:()=>j(!1),onFriendRequestSent:()=>{console.log("Friend request sent!")}}),R&&(0,a.jsx)(FriendRequestsModal,{onClose:()=>z(!1),onRequestHandled:()=>{let loadFriends=async()=>{try{let e=await fetch("/api/friends");if(e.ok){let r=await e.json();x(r)}}catch(e){console.error("Failed to reload friends:",e)}};loadFriends()}})]})}function Home(){let[e,r]=(0,s.useState)(null),[t,l]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{let checkAuth=async()=>{try{let e=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(e.ok){let t=await e.json();r(t)}else r(null)}catch(e){console.error("Auth check failed:",e),r(null)}finally{l(!1)}};checkAuth()},[]),t)?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})}):e?(0,a.jsx)(MessengerApp,{currentUser:e,onLogout:()=>{r(null)}}):(0,a.jsx)(LoginForm,{onLogin:e=>{r(e)}})}}},function(e){e.O(0,[427,971,472,744],function(){return e(e.s=7970)}),_N_E=e.O()}]);